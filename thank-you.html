<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>شكراً لتقديمك | ROYAL CORE</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html,body{margin:0;padding:0;height:100%;font-family:'Cairo',sans-serif;background:#0a1e4d;color:#facc15}
  .glass{backdrop-filter:blur(30px) saturate(180%);background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.25);border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.4)}
  .btn{background:linear-gradient(90deg,#facc15,#30e0b0);color:#0a1e4d;padding:.75rem 1.2rem;border-radius:14px;font-weight:900;box-shadow:0 0 24px #facc15aa}
</style>
</head>
<body>
<main class="p-6 max-w-3xl mx-auto">
  <section class="glass p-8 my-8 text-center">
    <h1 class="text-3xl md:text-4xl font-extrabold mb-2">شكراً لتقديمك 🙌</h1>
    <p class="text-white/90">تم تسجيل طلبك في نظامنا. يمكنك حفظ بطاقة المتابعة ومراجعة حالة الطلب في أي وقت.</p>
  </section>

  <section id="card" class="glass p-6 rounded-2xl">
    <div class="flex items-center justify-between flex-wrap gap-3 mb-3">
      <div class="bg-[#facc15] text-[#0a1e4d] font-bold rounded-full px-3 py-1">🪪 Client Card</div>
      <div id="cc-updated" class="text-white/80 text-sm">—</div>
    </div>
    <div class="grid md:grid-cols-2 gap-5">
      <div>
        <div id="cc-name" class="text-2xl font-extrabold text-white">—</div>
        <div id="cc-case" class="text-white/80 mt-1">🆔 —</div>
        <div id="cc-status" class="text-white/80 mt-1">📊 Submitted</div>
      </div>
      <div class="text-white/90">
        <div id="cc-contact">📧 — | 📱 —</div>
        <div id="cc-location" class="mt-1">📍 —</div>
      </div>
    </div>
    <div class="flex gap-3 mt-4">
      <a id="cc-edit" class="btn flex-1 text-center" target="_blank" rel="noopener">✏️ تعديل الطلب</a>
      <button id="cc-copy" class="btn flex-1">🔗 نسخ رابط البطاقة</button>
    </div>
  </section>

  <section class="glass p-6 rounded-2xl mt-4">
    <h3 class="font-bold mb-2">ما الخطوة التالية؟</h3>
    <ul class="text-white/90 list-disc pr-6 space-y-1">
      <li>احتفظ برقم القضية لديك — ستحتاجه عند الاستفسار.</li>
      <li>راجع بريدك الإلكتروني ورسائل هاتفك لأي تحديثات أو طلب مستندات.</li>
      <li>يمكنك العودة إلى هذه الصفحة لمتابعة الحالة في أي وقت.</li>
    </ul>
  </section>
</main>

<script>
const webAppUrl = 'https://script.google.com/macros/s/AKfycbwV5_K8M5HZtOCsL2LnY2LVzgYbWsJcvgRdiI82bxc2-9NGYGd-yYKXTtvuou66_5Lv/exec';

function p(k){ return new URLSearchParams(location.search).get(k) || ''; }

function render(d){
  const caseNo = d.caseNumber || d.caseId || p('uniqueId') || '—';
  const fullName = d.fullName || p('fullName4') || '—';
  const email = d.email || p('email5') || '—';
  const phone = d.phone || p('input45') || '—';
  const city = (d.address && d.address.city) || p('city') || '—';
  const st = d.applicationStatus || p('applicationStatus') || 'Submitted';
  const updated = (d.meta && d.meta.lastUpdateDate) || new Date().toLocaleString();

  document.getElementById('cc-name').textContent = fullName;
  document.getElementById('cc-case').textContent = '🆔 ' + caseNo;
  document.getElementById('cc-status').textContent = '📊 ' + st;
  document.getElementById('cc-contact').textContent = `📧 ${email} | 📱 ${phone}`;
  document.getElementById('cc-location').textContent = `📍 ${city}`;
  document.getElementById('cc-updated').textContent = updated;

  const submissionID = (d.meta && d.meta.submissionID) || p('submissionID') || '';
  const editUrl = (d.meta && d.meta.editUrl) || p('edit_link') || (submissionID ? `https://www.jotform.com/edit/${submissionID}` : '#');
  document.getElementById('cc-edit').href = editUrl;

  document.getElementById('cc-copy').onclick = ()=>{
    const url = `${location.origin}${location.pathname}?submissionID=${encodeURIComponent(submissionID)}&uniqueId=${encodeURIComponent(caseNo)}#card`;
    navigator.clipboard.writeText(url);
    alert('تم نسخ رابط البطاقة');
  };
}

(async function init(){
  // Instant render from URL tokens
  render({});

  // Enrich from backend using submissionID if present
  const sid = p('submissionID');
  if (sid) {
    try{
      const url = `${webAppUrl}?action=track&by=submission&key=${encodeURIComponent(sid)}`;
      const r = await fetch(url, {cache:'no-store'});
      if (r.ok){
        const d = await r.json();
        if (d && Object.keys(d).length) render(d);
      }
    }catch(_){}
  }
})();
</script>
</body>
</html>
