<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ | Royal Core Portal</title>
<meta name="color-scheme" content="dark light"/>

<style>
  :root{
    --bg1:#0a1e4d; --bg2:#0b1a3f; --bg3:#081333;
    --glass: rgba(255,255,255,.06);
    --stroke: rgba(255,255,255,.18);
    --gold:#facc15; --gold2:#ffe68a;
    --mint:#30e0b0; --lav:#bfa8ff;
    --text:#f7f9ff; --muted:#cfd3ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:"Cairo", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 800px at 15% 10%, #27408955, transparent 60%),
      radial-gradient(900px 700px at 85% 90%, #12204f55, transparent 55%),
      linear-gradient(135deg, var(--bg1), var(--bg2) 40%, var(--bg3));
    display:flex; align-items:center; justify-content:center; padding:24px;
    overflow-x:hidden;
  }
  .scene{position:fixed; inset:0; z-index:-2; overflow:hidden; pointer-events:none; filter:saturate(1.05)}
  .orb, .ring{position:absolute; will-change:transform, opacity; opacity:.65; mix-blend-mode:screen}
  .orb{ width:440px; height:440px; border-radius:50%;
        background:radial-gradient(circle at 30% 30%, #8c7cff, transparent 60%),
                   radial-gradient(circle at 70% 70%, var(--gold2), transparent 65%);
        box-shadow:0 0 80px #8c7cff33, 0 0 60px #ffe27a22; animation: float 16s ease-in-out infinite;}
  .orb.o1{ top:-140px; left:-140px; animation-delay:-2s}
  .orb.o2{ bottom:-160px; right:-180px; transform:scale(.85); animation-delay:-6s}
  .ring{ width:700px; height:700px; border-radius:50%;
         border:1px dashed rgba(255,255,255,.15);
         box-shadow:inset 0 0 80px #ffffff0f;
         top:-240px; right:-200px; animation: spin 28s linear infinite}
  @keyframes float{0%,100%{transform:translateY(0) translateX(0)}50%{transform:translateY(-14px) translateX(8px)}}
  @keyframes spin{to{transform:rotate(360deg)}}

  .wrap{ width:min(980px, 96vw) }
  .card{
    background:var(--glass);
    border:1px solid var(--stroke);
    border-radius:24px; padding:28px; position:relative; overflow:hidden;
    backdrop-filter: blur(14px);
    box-shadow: 0 12px 40px rgba(0,0,0,.35), inset 0 0 32px rgba(255,255,255,.05);
  }
  .card::before{
    content:""; position:absolute; inset:-2px; border-radius:26px; z-index:-1; opacity:.42;
    background: conic-gradient(from 220deg at 50% 50%, var(--lav), var(--gold), var(--lav));
    filter: blur(10px);
  }
  .edge{position:absolute; inset:1px; border-radius:22px; pointer-events:none;
    background:linear-gradient(180deg, #ffffff10, transparent); box-shadow:inset 0 0 60px #ffffff10}

  .header{text-align:center}
  .logo{max-width:120px; filter:drop-shadow(0 2px 8px rgba(0,0,0,.45))}
  .title{margin:10px 0 2px; font-weight:800; color:var(--gold);
         font-size:clamp(22px, 2.6vw, 30px)}
  .subtitle{margin:0; color:var(--lav); font-size:clamp(14px, 1.8vw, 18px)}
  .lead{margin:10px auto 0; max-width:760px; color:var(--muted); line-height:1.8; text-wrap:balance}

  .status, .case { text-align:center; margin:18px 0 6px; font-weight:800; color:var(--lav); font-size:clamp(15px, 2vw, 19px) }
  .pill{
    display:inline-block; padding:.35rem .8rem; border-radius:999px; font-weight:900;
    background:linear-gradient(45deg, #ffffff10, #ffffff05);
    border:1px solid rgba(255,255,255,.22); color:#fff;
    box-shadow: 0 0 30px #bfa8ff33, 0 0 18px #ffd70022;
  }

  .grid{ display:grid; gap:10px; margin-top:16px;
         grid-template-columns: 1fr 2fr;
         background:rgba(255,255,255,.04);
         border:1px solid rgba(255,255,255,.12); border-radius:16px; overflow:hidden; }
  .row{display:contents}
  .label{ padding:12px 14px; font-weight:800; color:var(--gold);
          border-bottom:1px solid rgba(255,255,255,.06);
          background:linear-gradient(90deg, rgba(255,255,255,.04), transparent)}
  .value{ padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.06)}

  .actions{ display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-top:18px }
  .btn{
    appearance:none; border:none; cursor:pointer; text-decoration:none; outline:none;
    padding:12px 16px; border-radius:14px; font-weight:900; letter-spacing:.25px; font-size:16px;
    color:#0e1333; background:linear-gradient(45deg, var(--gold), var(--gold2));
    box-shadow:0 10px 26px rgba(255,215,0,.28);
    transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
    display:inline-flex; align-items:center; gap:10px
  }
  .btn.alt{ color:#fff; background:linear-gradient(45deg, #8f7eff, #beaaff);
            box-shadow:0 10px 26px rgba(190,170,255,.28) }
  .btn.ghost{ color:#fff; background:transparent; border:1px solid rgba(255,255,255,.28) }
  .btn:hover{ transform:translateY(-2px) }
  .footer{ text-align:center; margin-top:16px; color:var(--muted); font-size:14px; line-height:1.9 }
  .contacts{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:6px }
  .tag{ padding:6px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.22);
        background:rgba(255,255,255,.06); color:#fff; font-weight:700 }
  .note{ text-align:center; color:#ffffffb0; font-size:12px; margin-top:6px }

  @media (max-width:700px){
    .grid{ grid-template-columns: 1fr }
    .label{ border-bottom:none }
    .value{ border-top:1px solid rgba(255,255,255,.06) }
  }
</style>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet"/>
</head>
<body>

<!-- Background -->
<div class="scene">
  <div class="orb o1"></div>
  <div class="orb o2"></div>
  <div class="ring"></div>
</div>

<div class="wrap">
  <div class="card" id="card">
    <div class="edge"></div>

    <header class="header">
      <img class="logo" src="https://drive.google.com/uc?id=1RMiZhmDaciD0QDxIMMrHRTYXHP5UK5Pl" alt="Alhijrah Logo" />
      <h1 class="title">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…</h1>
      <p class="subtitle">Career Gate â€“ Alhijrah Services</p>
      <p class="lead">
        Ø´ÙƒØ±Ù‹Ø§ Ù„ØªØ¹Ø¨Ø¦Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙˆØ¸ÙŠÙ. ÙØ±ÙŠÙ‚Ù†Ø§ Ø³ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ù„Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª.
        <br/>Thank you for your submission. Our team will contact you shortly.
      </p>
    </header>

    <p class="status">
      Application Status | Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:
      <span id="statusPill" class="pill">Received</span>
    </p>

    <p class="case">
      Case Number:
      <span id="casePill" class="pill">â€”</span>
    </p>

    <section class="grid" aria-label="Submission Summary">
      <div class="row"><div class="label">Full Name | Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</div><div id="vName"  class="value">â€”</div></div>
      <div class="row"><div class="label">Phone | Ø§Ù„Ù‡Ø§ØªÙ</div>       <div id="vPhone" class="value">â€”</div></div>
      <div class="row"><div class="label">Email | Ø§Ù„Ø¨Ø±ÙŠØ¯</div>       <div id="vEmail" class="value">â€”</div></div>
      <div class="row"><div class="label">City | Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</div>       <div id="vCity"  class="value">â€”</div></div>
      <div class="row"><div class="label">Submission ID</div>        <div id="vSid"   class="value">â€”</div></div>
      <div class="row"><div class="label">Last Update</div>          <div id="vUpd"   class="value">â€”</div></div>
    </section>

    <nav class="actions" role="group" aria-label="Actions">
      <a id="btnPdf"  class="btn"    href="#" target="_blank" rel="noopener">ØªØ­Ù…ÙŠÙ„ PDF | Download PDF</a>
      <a id="btnEdit" class="btn alt" href="#" target="_blank" rel="noopener">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ | Edit Submission</a>
      <a id="btnTrack" class="btn ghost" href="#" target="_blank" rel="noopener">ØªØªØ¨Ù‘Ø¹ Ø·Ù„Ø¨ÙŠ | Track My Case</a>
      <button id="btnCopy" class="btn ghost" type="button">Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„Ø©</button>
      <a id="btnWA" class="btn ghost" href="#" target="_blank" rel="noopener">Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± WhatsApp</a>
    </nav>

    <div class="note" id="note">ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ø°Ø§ ØªÙˆÙÙ‘Ø± Ø³Ø¬Ù„ Ø£Ø­Ø¯Ø«.</div>

    <footer class="footer">
      <div>ØªØµÙ…ÙŠÙ… Ù‡Ù†Ø¯Ø³ÙŠ Ø²Ø¬Ø§Ø¬ÙŠ ÙØ§Ø®Ø± â€” ØªØ¬Ø±Ø¨Ø© Ø±Ù‚Ù…ÙŠØ© Ø´ÙØ§ÙØ©ØŒ Ø§Ø­ØªØ±Ø§ÙÙŠØ©ØŒ ÙˆØ±Ø§Ù‚ÙŠØ©.</div>
      <div class="contacts">
        <span class="tag">ğŸ“ +1 313-919-4292</span>
        <span class="tag">ğŸ“§ jobs@alhijrahservices.com</span>
        <span class="tag">ğŸŒ Alhijrahvisa.com</span>
      </div>
      <div style="margin-top:8px">Career Gate powered by <strong>Alhijrah Services</strong></div>
    </footer>
  </div>
</div>

<!-- optional tiny english footnote -->
<div style="direction:ltr; text-align:center; margin-top:12px; opacity:.55; font:12px/1.7 system-ui">
  Need help? Email <a href="mailto:jobs@alhijrahservices.com">jobs@alhijrahservices.com</a>
</div>

<script>
/* ===== CONFIG ===== */
const webAppUrl = "https://script.google.com/macros/s/AKfycbx0j3SNg7KO-tLt3nyI6T4tLaLhoGWgj0zO-OVQyopqGZrNXeKD5tdRCW8aKRR4ubteqw/exec"; // your Apps Script /exec

/* ===== Utils ===== */
const qs = new URLSearchParams(location.search);
const normDigits = s=>String(s||"")
  .replace(/[Ù -Ù©]/g,d=>String.fromCharCode(d.charCodeAt(0)-1632))
  .replace(/[Û°-Û¹]/g,d=>String.fromCharCode(d.charCodeAt(0)-1776));
const readOne = (...names)=>{
  for(const n of names){
    const v = qs.get(n);
    if(v && String(v).trim()) return String(v).trim();
  }
  return "";
};
const normalizePhone = s=>{
  let x = String(s||"").replace(/[^\d+]/g,"");
  x = x.replace(/^(\++)/,"+");
  if (!/^\+/.test(x) && x.length===10) x = "+1"+x;
  return x;
};
const normalizeCaseId = s=>{
  return String(s||"").toUpperCase().replace(/\s+/g,"").replace(/[^A-Z0-9\-]/g,"");
};
const setText = (id, v)=>{ const el=document.getElementById(id); if(el) el.textContent = v || "â€”"; };

/* ===== 1) Read URL tokens from Jotform redirect ===== */
const raw = {
  submissionID : readOne("submissionID","sid","id"),
  uniqueId     : readOne("uniqueId","uniqueid","case","UniqueID"),
  fullName     : readOne("fullName","fullname","name","fullName4"),
  email        : readOne("email","e-mail"),
  phone        : readOne("phone","phoneNumber","input45"),
  city         : readOne("city","addr_city","address_city"),
  status       : readOne("applicationStatus","status"),
  pdf          : readOne("pdf","pdf-link","pdflink"),
  edit_link    : readOne("edit_link","edit","edit_url")
};

// prefer normalized values
raw.phone    = normalizePhone(normDigits(raw.phone));
raw.uniqueId = normalizeCaseId(normDigits(raw.uniqueId));
raw.submissionID = normDigits(raw.submissionID);

/* ===== 2) Paint instant UI from URL (fast) ===== */
function paintInstant(){
  const caseText = raw.uniqueId || (raw.submissionID ? ("ALH-"+new Date().toISOString().slice(0,10).replace(/-/g,"")+ "-"+raw.submissionID) : "â€”");
  setText("casePill", caseText);
  setText("statusPill", raw.status || "Received");
  setText("vName",  raw.fullName);
  setText("vPhone", raw.phone);
  setText("vEmail", raw.email?.toLowerCase());
  setText("vCity",  raw.city);
  setText("vSid",   raw.submissionID);
  setText("vUpd",   new Date().toLocaleString());

  const trackUrl = `${location.origin}${location.pathname.replace(/thankyou\.html/i,'')}`; // keep simple
  document.getElementById("btnTrack").href = `https://alhijrahvisa.com/track?case=${encodeURIComponent(caseText)}`;
  document.getElementById("btnEdit").href  = raw.edit_link || "#";
  document.getElementById("btnPdf").href   = raw.pdf || "#";

  document.getElementById("btnCopy").onclick = ()=>{
    navigator.clipboard.writeText(caseText).then(()=>alert("ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„Ø©"));
  };

  const waText = [
    "ALHIJRAH â€“ Submission",
    `Case: ${caseText}`,
    `Status: ${raw.status || "Received"}`,
    `Name: ${raw.fullName || "â€”"}`,
    `Phone: ${raw.phone || "â€”"}`,
    `Email: ${raw.email || "â€”"}`,
    raw.pdf ? `PDF: ${raw.pdf}` : ""
  ].filter(Boolean).join("\n");
  document.getElementById("btnWA").href = "https://wa.me/13139194292?text="+encodeURIComponent(waText);
}

/* ===== 3) Enrich from Apps Script (always newest) ===== */
async function enrichFromServer(){
  let url = "";
  if (raw.submissionID) {
    url = `${webAppUrl}?by=submission&key=${encodeURIComponent(raw.submissionID)}`;
  } else if (raw.uniqueId) {
    url = `${webAppUrl}?by=case&key=${encodeURIComponent(raw.uniqueId)}`;
  } else if (raw.email) {
    url = `${webAppUrl}?by=email&key=${encodeURIComponent(raw.email.toLowerCase())}`;
  } else if (raw.phone) {
    url = `${webAppUrl}?by=phone&key=${encodeURIComponent(raw.phone)}`;
  } else {
    return; // nothing to enrich with
  }

  try{
    const r = await fetch(url, {headers:{Accept:"application/json"}, cache:"no-store"});
    if(!r.ok) throw new Error("HTTP "+r.status);
    const d = await r.json();
    if(d && !d.error){
      // overwrite with canonical values
      setText("casePill", d.caseNumber || d.caseId || raw.uniqueId || "â€”");
      setText("statusPill", d.applicationStatus || d.status || raw.status || "Received");
      setText("vName",  d.fullName || raw.fullName);
      setText("vPhone", d.phone    || raw.phone);
      setText("vEmail", (d.email||"").toLowerCase() || raw.email?.toLowerCase());
      setText("vCity",  (d.address && d.address.city) || d.city || raw.city);
      setText("vSid",   d.meta?.submissionId || raw.submissionID);
      setText("vUpd",   d.meta?.lastUpdateDate || d.updatedAt || new Date().toLocaleString());

      const caseText = d.caseNumber || d.caseId || raw.uniqueId || "â€”";
      document.getElementById("btnTrack").href = `https://alhijrahvisa.com/track?case=${encodeURIComponent(caseText)}`;
      document.getElementById("btnEdit").href  = d.meta?.editUrl || raw.edit_link || "#";
    }
  }catch(_){
    // keep instant paints
  }
}

/* ===== Boot ===== */
paintInstant();
enrichFromServer();

</script>
</body>
</html>
